<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento Confirmado - Jornal do Reino dos Céus</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,400&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/checkout/styles/success.css">
</head>
<body>
    <div class="success-container">
        <div class="success-card">
            <!-- Success Animation -->
            <div class="success-animation">
                <div class="success-icon">
                    <i class='bx bx-check-circle'></i>
                </div>
                <div class="success-circle"></div>
            </div>

            <!-- Success Message -->
            <div class="success-content">
                <h1 class="success-title">Pagamento Confirmado!</h1>
                <p class="success-subtitle">Seu pagamento foi processado com sucesso.</p>
                <p class="success-message" id="successMessage">
                    Você será direcionado para a página de download em instantes.
                </p>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <div class="download-card">
                    <div class="download-icon">
                        <i class='bx bx-download'></i>
                    </div>
                    <h2>Baixe seu Jornal</h2>
                    <p>Clique no botão abaixo para fazer o download do PDF</p>
                    <button id="downloadButton" class="download-button">
                        <i class='bx bx-download'></i>
                        <span>Fazer Download do PDF</span>
                    </button>
                    <small class="download-hint" id="downloadHint"></small>
                </div>
            </div>

            <!-- Order Details -->
            <div class="order-details">
                <h3>Detalhes do Pedido</h3>
                <div class="detail-row">
                    <span class="detail-label">Produto:</span>
                    <span class="detail-value" id="productName">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">E-mail:</span>
                    <span class="detail-value" id="customerEmail">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Data:</span>
                    <span class="detail-value" id="orderDate">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value status-success">
                        <i class='bx bx-check-circle'></i>
                        Pago
                    </span>
                </div>
            </div>

            <!-- Actions -->
            <div class="success-actions">
                <a href="/" class="btn-primary">
                    <i class='bx bx-home'></i>
                    <span>Voltar para o Início</span>
                </a>
                <a href="/pag-saibaMais.html" class="btn-secondary">
                    <i class='bx bx-book'></i>
                    <span>Ver Mais Jornais</span>
                </a>
            </div>
        </div>
    </div>

    <script src="/checkout/scripts/success.js"></script>
    
    <!-- Handler global para erros não tratados de extensões do navegador -->
    <script>
      // Capturar erros de promise não tratados (principalmente de extensões do Chrome)
      window.addEventListener('unhandledrejection', function(event) {
        const error = event.reason;
        
        // Verificar se é um erro de extensão do Chrome
        if (error && typeof error === 'object') {
          const errorString = JSON.stringify(error).toLowerCase();
          const errorMessage = (error.message || '').toLowerCase();
          const errorName = (error.name || '').toLowerCase();
          const errorCode = error.code;
          const httpStatus = error.httpStatus;
          
          // Verificar stack trace se disponível
          let originalErrorStack = '';
          if (error.originalError && error.originalError.stack) {
            originalErrorStack = error.originalError.stack.toLowerCase();
          }
          
          // Verificar reqInfo se disponível
          let reqPath = '';
          let reqPathPrefix = '';
          if (error.reqInfo) {
            reqPath = (error.reqInfo.path || '').toLowerCase();
            reqPathPrefix = (error.reqInfo.pathPrefix || '').toLowerCase();
          }
          
          // Ignorar erros de extensões do Chrome (permission errors, template_list, etc)
          if (
            errorCode === 403 ||
            (httpStatus === 200 && errorCode === 403) ||
            originalErrorStack.includes('background.js') ||
            originalErrorStack.includes('chrome-extension') ||
            reqPath.includes('/writing/') ||
            reqPath.includes('/site_integration/') ||
            reqPathPrefix.includes('/writing') ||
            reqPathPrefix.includes('/site_integration') ||
            errorMessage.includes('permission error') ||
            errorMessage.includes('userautherror') ||
            reqPath.includes('get_template_list') ||
            reqPath.includes('template_list') ||
            errorString.includes('site_integration') ||
            errorString.includes('template_list') ||
            errorString.includes('permission error') ||
            errorString.includes('background.js') ||
            errorString.includes('userautherror')
          ) {
            // Silenciar completamente - é de extensão do navegador
            event.preventDefault();
            event.stopPropagation();
            return;
          }
        }
        
        // Para outros erros, apenas logar sem mostrar no console como erro não tratado
        console.warn('Promise rejeitada (já tratada):', error);
        event.preventDefault();
      });
      
      // Também capturar erros gerais não tratados
      window.addEventListener('error', function(event) {
        const error = event.error;
        const errorSource = (event.filename || '').toLowerCase();
        const errorMessage = (event.message || '').toLowerCase();
        
        // Ignorar erros de extensões
        if (
          errorSource.includes('chrome-extension') ||
          errorSource.includes('background.js') ||
          errorMessage.includes('permission error') ||
          errorMessage.includes('template_list') ||
          errorMessage.includes('get_template_list')
        ) {
          event.preventDefault();
          return;
        }
      });
    </script>
</body>
</html>
